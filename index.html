<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>First Line EMS Employee Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#f5f6f8; margin:0; }
    .container { max-width: 900px; margin: 40px auto; padding: 20px; }
    .card { background:#fff; border-radius:14px; padding:24px; box-shadow:0 10px 25px rgba(0,0,0,.08); }
    h1 { margin:0 0 12px 0; font-size:24px; }
    input { width:100%; padding:12px; margin:8px 0; border-radius:10px; border:1px solid #ddd; font-size:16px; }
    button { padding:12px 16px; border-radius:10px; border:none; background:#111; color:#fff; font-size:16px; font-weight:700; cursor:pointer; margin-top:10px; }
    button.secondary { background:#eaeaea; color:#111; }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .hidden { display:none; }
    .error { color:#b00020; margin-top:10px; font-weight:600; }
    .pill { background:#eee; border-radius:999px; padding:6px 12px; font-size:13px; font-weight:700; }
    iframe { width:100%; height:70vh; border:1px solid #ddd; border-radius:12px; margin-top:12px; background:#fff; }
    .debug { margin-top:10px; font-weight:700; color:#111; }
  </style>
</head>
<body>

<div class="container">

  <!-- LOGIN -->
  <div id="login" class="card">
    <h1>First Line EMS – Employee Login</h1>
    <input id="email" type="email" placeholder="Email" />
    <input id="password" type="password" placeholder="Password" />
    <button id="loginBtn">Login</button>

    <div id="debug" class="debug"></div>
    <div id="loginError" class="error"></div>
  </div>

  <!-- PORTAL -->
  <div id="portal" class="card hidden">
    <div class="row" style="justify-content:space-between;">
      <span class="pill" id="userEmail"></span>
      <button class="secondary" id="logoutBtn">Logout</button>
    </div>

    <h1 style="margin-top:16px;">Employee Portal</h1>

    <div class="row">
      <button id="schedBtn">Scheduling</button>
      <button id="annBtn">Announcements</button>
    </div>

    <div id="content"></div>
  </div>

</div>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

  // ====== YOUR SUPABASE VALUES ======
  const SUPABASE_URL = "https://lnevuelwsiewxdrmgckh.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxuZXZ1ZWx3c2lld3hkcm1nY2toIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3MzMyNjgsImV4cCI6MjA4NjMwOTI2OH0.voDpAvnscFh9-e70-xV4UBxtcO-TwYbU6V0JRPUFFIs";
  // =================================

  const debugEl = document.getElementById("debug");
  const setDebug = (msg) => { debugEl.textContent = msg || ""; };

  // Catch any errors and show them on-screen (no silent failures)
  window.addEventListener("error", (e) => setDebug("JS error: " + (e?.message || e)));
  window.addEventListener("unhandledrejection", (e) => setDebug("Promise error: " + (e?.reason?.message || e?.reason || e)));

  setDebug("JS loaded ✅");

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const loginEl = document.getElementById("login");
  const portalEl = document.getElementById("portal");
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const schedBtn = document.getElementById("schedBtn");
  const annBtn = document.getElementById("annBtn");

  const loginError = document.getElementById("loginError");
  const emailEl = document.getElementById("email");
  const passwordEl = document.getElementById("password");
  const userEmailEl = document.getElementById("userEmail");
  const contentEl = document.getElementById("content");

  function showSchedule() {
    contentEl.innerHTML = `
      <h3>Scheduling</h3>
      <iframe src="https://REPLACE_WITH_YOUR_SCHEDULER"></iframe>
    `;
  }

  function showAnnouncements() {
    contentEl.innerHTML = `
      <h3>Announcements</h3>
      <p>Announcements will appear here.</p>
    `;
  }

  function showPortal(user) {
    loginEl.classList.add("hidden");
    portalEl.classList.remove("hidden");
    userEmailEl.textContent = user.email;
    showSchedule();
  }

  loginBtn.addEventListener("click", async () => {
    setDebug("Login clicked ✅");
    loginError.textContent = "";

    const email = emailEl.value.trim();
    const password = passwordEl.value.trim();

    if (!email || !password) {
      loginError.textContent = "Enter email and password.";
      return;
    }

    const { data, error } = await supabase.auth.signInWithPassword({ email, password });

    if (error) {
      loginError.textContent = error.message;
      return;
    }

    showPortal(data.user);
  });

  logoutBtn.addEventListener("click", async () => {
    await supabase.auth.signOut();
    location.reload();
  });

  schedBtn.addEventListener("click", showSchedule);
  annBtn.addEventListener("click", showAnnouncements);

  // Auto-login if already signed in
  const { data } = await supabase.auth.getSession();
  if (data?.session?.user) showPortal(data.session.user);
</script>

</body>
</html>
